# Debug configuration for all services
# Usage: skaffold dev -f skaffold.yaml --profile debug
# Or manually: helm upgrade --install -f values.yaml -f values.debug.yaml ...

ecommerce-product-service:
  nameOverride: ecommerce-product-service
  debugPort: 2345
  command: ["/dlv"]
  args:
    - "exec"
    - "/server"
    - "--listen=:2345"
    - "--headless=true"
    - "--api-version=2"
    - "--accept-multiclient"
    - "--continue"
  # Startup probe з великим таймаутом для початкового запуску
  startupProbe:
    httpGet:
      path: /health/live
      port: http
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30  # 30 * 10s = 5 хвилин на старт
  # Liveness з великим timeout щоб не вбивало на breakpoint (але вбивало crashed app)
  livenessProbe:
    httpGet:
      path: /health/live
      port: http
    initialDelaySeconds: 30
    periodSeconds: 60
    timeoutSeconds: 10
    failureThreshold: 15  # 15 * 60s = 15 хвилин на breakpoint
  # Вимикаємо readiness в дебазі - вона заважає при breakpoints
  readinessProbe: {}

ecommerce-category-service:
  nameOverride: ecommerce-category-service
  debugPort: 2345
  command: ["/dlv"]
  args:
    - "exec"
    - "/server"
    - "--listen=:2345"
    - "--headless=true"
    - "--api-version=2"
    - "--accept-multiclient"
    - "--continue"
  startupProbe:
    httpGet:
      path: /health/live
      port: http
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30
  livenessProbe:
    httpGet:
      path: /health/live
      port: http
    initialDelaySeconds: 30
    periodSeconds: 60
    timeoutSeconds: 10
    failureThreshold: 15
  readinessProbe: {}

ecommerce-product-query-service:
  nameOverride: ecommerce-product-query-service
  debugPort: 2345
  command: ["/dlv"]
  args:
    - "exec"
    - "/server"
    - "--listen=:2345"
    - "--headless=true"
    - "--api-version=2"
    - "--accept-multiclient"
    - "--continue"
  startupProbe:
    httpGet:
      path: /health/live
      port: http
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30
  livenessProbe:
    httpGet:
      path: /health/live
      port: http
    initialDelaySeconds: 30
    periodSeconds: 60
    timeoutSeconds: 10
    failureThreshold: 15
  readinessProbe: {}

ecommerce-category-query-service:
  nameOverride: ecommerce-category-query-service
  debugPort: 2345
  command: ["/dlv"]
  args:
    - "exec"
    - "/server"
    - "--listen=:2345"
    - "--headless=true"
    - "--api-version=2"
    - "--accept-multiclient"
    - "--continue"
  startupProbe:
    httpGet:
      path: /health/live
      port: http
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30
  livenessProbe:
    httpGet:
      path: /health/live
      port: http
    initialDelaySeconds: 30
    periodSeconds: 60
    timeoutSeconds: 10
    failureThreshold: 15
  readinessProbe: {}

ecommerce-image-service:
  nameOverride: ecommerce-image-service
  debugPort: 2345
  command: ["/dlv"]
  args:
    - "exec"
    - "/server"
    - "--listen=:2345"
    - "--headless=true"
    - "--api-version=2"
    - "--accept-multiclient"
    - "--continue"
  startupProbe:
    httpGet:
      path: /health/live
      port: http
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30
  livenessProbe:
    httpGet:
      path: /health/live
      port: http
    initialDelaySeconds: 30
    periodSeconds: 60
    timeoutSeconds: 10
    failureThreshold: 15
  readinessProbe: {}

ecommerce-admin-ui:
  nameOverride: ecommerce-admin-ui